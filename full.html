<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>재무설계 상세 정보 입력</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --gold: #8B7355;
  --gold-light: #B8A088;
  --gold-dark: #6B5740;
  --bg: #FAFAF8;
  --card: #FFFFFF;
  --text: #2D2A26;
  --text-sub: #8C8680;
  --border: #E8E4DF;
  --input-bg: #F7F5F2;
  --input-focus: #FDF8F3;
  --accent: #D4A574;
  --success: #6B8F5E;
  --error: #C75C5C;
  --step-done: #6B8F5E;
  --step-active: var(--gold);
  --step-future: #D5D0CB;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Noto Sans KR', -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
}
.header {
  background: linear-gradient(135deg, var(--gold-dark) 0%, var(--gold) 50%, var(--accent) 100%);
  padding: 2rem 1.5rem 1.5rem;
  text-align: center;
  position: relative;
  overflow: hidden;
}
.header::before {
  content: '';
  position: absolute;
  top: -50%; left: -50%;
  width: 200%; height: 200%;
  background: radial-gradient(circle at 30% 70%, rgba(255,255,255,0.08) 0%, transparent 50%);
}
.header-badge {
  display: inline-block;
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.2);
  border-radius: 2rem;
  padding: 0.3rem 1rem;
  font-size: 0.7rem;
  font-weight: 500;
  color: rgba(255,255,255,0.9);
  letter-spacing: 0.1em;
  margin-bottom: 0.8rem;
}
.header h1 {
  color: #fff; font-size: 1.35rem; font-weight: 700;
  letter-spacing: -0.02em; margin-bottom: 0.3rem; position: relative;
}
.header p { color: rgba(255,255,255,0.75); font-size: 0.8rem; font-weight: 300; position: relative; }

/* 스텝 인디케이터 */
.step-bar {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0;
  padding: 1rem 1rem 0.5rem;
  max-width: 500px;
  margin: 0 auto;
  flex-wrap: wrap;
}
.step-dot {
  width: 28px; height: 28px;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 0.65rem; font-weight: 700; color: #fff;
  background: var(--step-future);
  transition: all 0.3s;
  flex-shrink: 0;
}
.step-dot.active { background: var(--step-active); transform: scale(1.15); }
.step-dot.done { background: var(--step-done); }
.step-line {
  flex: 1; height: 2px; background: var(--step-future);
  min-width: 8px; max-width: 30px;
  transition: background 0.3s;
}
.step-line.done { background: var(--step-done); }
.step-label {
  width: 100%;
  text-align: center;
  font-size: 0.72rem;
  color: var(--text-sub);
  margin-top: 0.3rem;
}
.step-label strong { color: var(--gold); }

/* 컨테이너 */
.container {
  max-width: 500px;
  margin: 0 auto;
  padding: 0.75rem 1.5rem 3rem;
}

/* 스텝 페이지 */
.step-page { display: none; }
.step-page.active { display: block; animation: fadeUp 0.25s ease; }
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

/* 섹션 */
.section {
  background: var(--card);
  border-radius: 14px;
  padding: 1.3rem;
  margin-bottom: 0.8rem;
  border: 1px solid var(--border);
  box-shadow: 0 1px 3px rgba(0,0,0,0.03);
}
.section-title {
  display: flex; align-items: center;
  font-size: 0.95rem; font-weight: 700;
  color: var(--text); margin-bottom: 1rem;
}
.section-num {
  display: inline-flex; align-items: center; justify-content: center;
  width: 1.5rem; height: 1.5rem;
  background: var(--gold); color: #fff;
  border-radius: 50%; font-size: 0.7rem; font-weight: 700;
  margin-right: 0.5rem; flex-shrink: 0;
}
.section-desc {
  font-size: 0.75rem; color: var(--text-sub);
  margin: -0.7rem 0 1rem 2rem;
}

/* 입력 필드 */
.field { margin-bottom: 0.85rem; }
.field:last-child { margin-bottom: 0; }
.field label {
  display: block; font-size: 0.78rem; font-weight: 500;
  color: var(--text-sub); margin-bottom: 0.3rem;
}
.field label .req { color: var(--error); margin-left: 2px; }
.field input, .field select, .field textarea {
  width: 100%; padding: 0.7rem 0.9rem;
  border: 1px solid var(--border); border-radius: 10px;
  background: var(--input-bg); font-family: inherit;
  font-size: 0.9rem; color: var(--text);
  transition: all 0.2s; outline: none;
  appearance: none; -webkit-appearance: none;
}
.field input:focus, .field select:focus, .field textarea:focus {
  border-color: var(--gold); background: var(--input-focus);
  box-shadow: 0 0 0 3px rgba(139,115,85,0.08);
}
.field input::placeholder { color: #C5C0BA; font-weight: 300; }
.field textarea { resize: none; min-height: 55px; }
.field select {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath d='M2 4l4 4 4-4' stroke='%238C8680' stroke-width='1.5' fill='none'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: right 0.9rem center;
  padding-right: 2.3rem;
}
.iu { position: relative; }
.iu input { padding-right: 3rem; }
.iu .unit {
  position: absolute; right: 0.9rem; top: 50%;
  transform: translateY(-50%); font-size: 0.75rem;
  color: var(--text-sub); pointer-events: none;
}
.row { display: grid; grid-template-columns: 1fr 1fr; gap: 0.6rem; }
.row3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.6rem; }

/* 서브 그룹 */
.sub-group {
  background: var(--input-bg);
  border-radius: 10px;
  padding: 0.8rem;
  margin-bottom: 0.6rem;
  position: relative;
}
.sub-group .sg-label {
  position: absolute; top: -0.45rem; left: 0.7rem;
  font-size: 0.62rem; font-weight: 700;
  color: var(--gold); background: var(--card);
  padding: 0 0.3rem;
}
.sub-group input, .sub-group select { background: var(--card); }

/* 구분선 */
.divider {
  display: flex; align-items: center; gap: 0.5rem;
  margin: 1rem 0 0.8rem; font-size: 0.72rem;
  font-weight: 600; color: var(--gold);
}
.divider::after {
  content: ''; flex: 1; height: 1px; background: var(--border);
}

/* 네비게이션 */
.nav-btns {
  display: flex; gap: 0.7rem; margin-top: 1rem;
}
.btn {
  flex: 1; padding: 0.85rem;
  border: none; border-radius: 12px;
  font-family: inherit; font-size: 0.9rem; font-weight: 600;
  cursor: pointer; transition: all 0.2s;
}
.btn-prev {
  background: var(--input-bg); color: var(--text-sub);
  border: 1px solid var(--border);
}
.btn-prev:hover { background: var(--border); }
.btn-next {
  background: linear-gradient(135deg, var(--gold-dark), var(--gold));
  color: #fff;
  box-shadow: 0 3px 10px rgba(139,115,85,0.2);
}
.btn-next:hover { transform: translateY(-1px); box-shadow: 0 5px 14px rgba(139,115,85,0.3); }
.btn-next:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
.btn-submit {
  background: linear-gradient(135deg, var(--gold-dark), var(--gold));
  color: #fff; width: 100%; padding: 1rem;
  box-shadow: 0 4px 12px rgba(139,115,85,0.25);
}
.btn-submit:hover { transform: translateY(-1px); }
.btn-submit:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
.spinner {
  display: inline-block; width: 16px; height: 16px;
  border: 2px solid rgba(255,255,255,0.3);
  border-top-color: #fff; border-radius: 50%;
  animation: spin 0.6s linear infinite;
  vertical-align: middle; margin-right: 0.4rem;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* 완료 */
.done-screen {
  display: none; text-align: center;
  padding: 3rem 2rem; max-width: 500px; margin: 0 auto;
}
.done-icon {
  width: 72px; height: 72px;
  background: linear-gradient(135deg, var(--success), #7DA66E);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  margin: 0 auto 1.3rem;
  animation: popIn 0.4s cubic-bezier(0.175,0.885,0.32,1.275);
}
@keyframes popIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }
.done-icon svg { width: 36px; height: 36px; stroke: #fff; stroke-width: 3; fill: none; }
.done-screen h2 { font-size: 1.2rem; font-weight: 700; margin-bottom: 0.4rem; }
.done-screen p { font-size: 0.85rem; color: var(--text-sub); line-height: 1.7; }

/* 에러 */
.error-msg {
  display: none;
  background: #FFF5F5; border: 1px solid #F5D0D0;
  border-radius: 10px; padding: 0.7rem 0.9rem;
  margin-bottom: 0.8rem; font-size: 0.78rem; color: var(--error);
}

/* 하단 안내 */
.footer-note {
  text-align: center; padding: 0.5rem 1.5rem 2rem;
  max-width: 500px; margin: 0 auto;
}
.footer-note p { font-size: 0.68rem; color: var(--text-sub); line-height: 1.7; }

/* 보험 항목 리피터 */
.ins-item {
  background: var(--input-bg); border-radius: 10px;
  padding: 0.8rem; margin-bottom: 0.5rem;
  position: relative;
}
.ins-item .ins-label {
  font-size: 0.7rem; font-weight: 600; color: var(--gold);
  margin-bottom: 0.5rem;
}
</style>
</head>
<body>

<div id="fcSearchView" style="max-width:480px; margin:0 auto;">
  <div class="header">
    <div class="header-badge">ROYAL TEAM · 정식</div>
    <h1>맞춤 재무설계 상세 입력</h1>
    <p>먼저 담당 FC를 확인해주세요</p>
  </div>
  <div style="padding:1.5rem;">
    <div class="section">
      <div class="section-title"><span class="section-num">✦</span>담당 FC 확인</div>
      <p style="font-size:0.85rem; color:var(--text-sub); margin-bottom:1rem;">담당 재무설계사(FC) 이름을 입력해주세요.</p>
      <div class="row">
        <div class="field" style="flex:1;">
          <label>FC 이름 <span class="req">*</span></label>
          <div style="display:flex; gap:0.5rem;">
            <input type="text" id="fcNameInput" placeholder="이름 입력" style="flex:1; padding:0.65rem 0.8rem; border:1px solid var(--border); border-radius:0.5rem; font-size:0.9rem;">
            <button type="button" id="fcSearchBtn" style="padding:0.6rem 1.2rem; background:var(--gold); color:#fff; border:none; border-radius:0.5rem; font-size:0.85rem; font-weight:500; cursor:pointer; white-space:nowrap;">검색</button>
          </div>
        </div>
      </div>
      <div id="fcSearchResult" style="margin-top:1rem; display:none;"></div>
      <div id="fcConfirmed" style="margin-top:1rem; display:none; padding:0.8rem 1rem; background:#F0EDE8; border-radius:0.5rem;">
        <span style="font-size:0.85rem; color:var(--gold-dark); font-weight:500;" id="fcConfirmedText"></span>
        <input type="hidden" id="fcId" value="">
        <input type="hidden" id="fcNameVal" value="">
      </div>
      <button type="button" id="fcNextBtn" disabled style="margin-top:1.5rem; width:100%; padding:0.9rem; background:var(--gold); color:#fff; border:none; border-radius:0.6rem; font-size:0.95rem; font-weight:600; cursor:pointer; opacity:0.4; transition:opacity 0.3s;">정보 입력 시작 →</button>
    </div>
  </div>
</div>

<div id="formView" style="display:none;">
  <div class="header">
    <div class="header-badge">ROYAL TEAM · 정식</div>
    <h1>맞춤 재무설계 상세 입력</h1>
    <p>단계별로 천천히 입력해주세요</p>
  </div>

  <!-- 스텝 인디케이터 -->
  <div class="step-bar" id="stepBar">
    <div class="step-dot active" data-step="1">1</div><div class="step-line"></div>
    <div class="step-dot" data-step="2">2</div><div class="step-line"></div>
    <div class="step-dot" data-step="3">3</div><div class="step-line"></div>
    <div class="step-dot" data-step="4">4</div><div class="step-line"></div>
    <div class="step-dot" data-step="5">5</div><div class="step-line"></div>
    <div class="step-dot" data-step="6">6</div><div class="step-line"></div>
    <div class="step-dot" data-step="7">7</div><div class="step-line"></div>
    <div class="step-dot" data-step="8">8</div>
    <div class="step-label"><strong id="stepTitle">Step 1</strong> / 8</div>
  </div>

  <div class="container">
    <div id="errorMsg" class="error-msg"></div>

    <!-- ============ STEP 1: 기본 인적사항 + 가족 ============ -->
    <div class="step-page active" data-step="1">
      <div class="section">
        <div class="section-title"><span class="section-num">1</span>기본 인적사항</div>
        <div class="row">
          <div class="field"><label>성명 <span class="req">*</span></label>
            <input type="text" name="name" placeholder="홍길동" required></div>
          <div class="field"><label>생년월일 <span class="req">*</span></label>
            <input type="text" name="birth" placeholder="1985.03.15" inputmode="numeric" class="auto-date"></div>
        </div>
        <div class="row">
          <div class="field"><label>성별</label>
            <select name="gender"><option value="">선택</option><option>남</option><option>여</option></select></div>
          <div class="field"><label>휴대폰</label>
            <input type="tel" name="phone" placeholder="010-1234-5678" class="auto-phone"></div>
        </div>
        <div class="row">
          <div class="field"><label>이메일</label>
            <input type="email" name="email" placeholder="email@example.com"></div>
          <div class="field"><label>주소</label>
            <input type="text" name="address" placeholder="서울시 강남구"></div>
        </div>
        <div class="row">
          <div class="field"><label>직업</label>
            <input type="text" name="job" placeholder="회사원"></div>
          <div class="field"><label>직장명 / 직위</label>
            <input type="text" name="company" placeholder="삼성전자 / 과장"></div>
        </div>
        <div class="row">
          <div class="field"><label>예상 은퇴나이</label>
            <div class="iu"><input type="text" name="retire_age_plan" placeholder="60" inputmode="numeric"><span class="unit">세</span></div></div>
          <div class="field"><label>건강상태</label>
            <select name="health"><option value="">선택</option><option>양호</option><option>보통</option><option>관리중</option></select></div>
        </div>
      </div>

      <div class="section">
        <div class="section-title"><span class="section-num">②</span>배우자 정보</div>
        <div class="row">
          <div class="field"><label>배우자 성명</label>
            <input type="text" name="sp_name" placeholder="김영희"></div>
          <div class="field"><label>생년월일</label>
            <input type="text" name="sp_birth" placeholder="1987.05.20" inputmode="numeric" class="auto-date"></div>
        </div>
        <div class="row">
          <div class="field"><label>직업</label>
            <input type="text" name="sp_job" placeholder="프리랜서"></div>
          <div class="field"><label>직장명 / 직위</label>
            <input type="text" name="sp_company" placeholder="디자인스튜디오 / 대표"></div>
        </div>
        <div class="row">
          <div class="field"><label>예상 은퇴나이</label>
            <div class="iu"><input type="text" name="sp_retire_age" placeholder="55" inputmode="numeric"><span class="unit">세</span></div></div>
          <div class="field"><label>휴대폰</label>
            <input type="tel" name="sp_phone" placeholder="010-9876-5432" class="auto-phone"></div>
        </div>
      </div>

      <div class="section">
        <div class="section-title"><span class="section-num">③</span>가족사항 (자녀)</div>
        <div class="sub-group"><span class="sg-label">자녀 1</span>
          <div class="row3">
            <div class="field"><label>이름</label><input type="text" name="c1_name" placeholder="홍민준"></div>
            <div class="field"><label>생년월일</label><input type="text" name="c1_birth" placeholder="2018.06" inputmode="numeric"></div>
            <div class="field"><label>학력/비고</label><input type="text" name="c1_note" placeholder="초2"></div>
          </div>
        </div>
        <div class="sub-group"><span class="sg-label">자녀 2</span>
          <div class="row3">
            <div class="field"><label>이름</label><input type="text" name="c2_name"></div>
            <div class="field"><label>생년월일</label><input type="text" name="c2_birth" inputmode="numeric"></div>
            <div class="field"><label>학력/비고</label><input type="text" name="c2_note"></div>
          </div>
        </div>
        <div class="sub-group"><span class="sg-label">자녀 3</span>
          <div class="row3">
            <div class="field"><label>이름</label><input type="text" name="c3_name"></div>
            <div class="field"><label>생년월일</label><input type="text" name="c3_birth" inputmode="numeric"></div>
            <div class="field"><label>학력/비고</label><input type="text" name="c3_note"></div>
          </div>
        </div>
      </div>

      <div class="nav-btns">
        <button class="btn btn-next" onclick="goStep(2)">다음 →</button>
      </div>
    </div>

    <!-- ============ STEP 2: 수입·지출 ============ -->
    <div class="step-page" data-step="2">
      <div class="section">
        <div class="section-title"><span class="section-num">1</span>월 수입 현황</div>
        <div class="section-desc">세전 기준, 만원 단위로 입력</div>
        <div class="row">
          <div class="field"><label>급여소득 (본인)</label>
            <div class="iu"><input type="text" name="inc_salary" inputmode="numeric" class="money" placeholder="550"><span class="unit">만원</span></div></div>
          <div class="field"><label>급여소득 (배우자)</label>
            <div class="iu"><input type="text" name="inc_salary_sp" inputmode="numeric" class="money" placeholder="0"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>사업소득 (본인)</label>
            <div class="iu"><input type="text" name="inc_biz" inputmode="numeric" class="money" placeholder="0"><span class="unit">만원</span></div></div>
          <div class="field"><label>사업소득 (배우자)</label>
            <div class="iu"><input type="text" name="inc_biz_sp" inputmode="numeric" class="money" placeholder="0"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>임대소득</label>
            <div class="iu"><input type="text" name="inc_rent" inputmode="numeric" class="money" placeholder="0"><span class="unit">만원</span></div></div>
          <div class="field"><label>이자/배당소득</label>
            <div class="iu"><input type="text" name="inc_interest" inputmode="numeric" class="money" placeholder="0"><span class="unit">만원</span></div></div>
        </div>
        <div class="field"><label>기타소득</label>
          <div class="iu"><input type="text" name="inc_etc" inputmode="numeric" class="money" placeholder="0"><span class="unit">만원</span></div></div>
      </div>

      <div class="section">
        <div class="section-title"><span class="section-num">2</span>월 지출 현황</div>
        <div class="row">
          <div class="field"><label>주거비 (월세/관리비)</label>
            <div class="iu"><input type="text" name="exp_housing" inputmode="numeric" class="money" placeholder="80"><span class="unit">만원</span></div></div>
          <div class="field"><label>식비 (외식 포함)</label>
            <div class="iu"><input type="text" name="exp_food" inputmode="numeric" class="money" placeholder="60"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>교육비 (학원/과외)</label>
            <div class="iu"><input type="text" name="exp_edu" inputmode="numeric" class="money" placeholder="40"><span class="unit">만원</span></div></div>
          <div class="field"><label>보험료 (사보험)</label>
            <div class="iu"><input type="text" name="exp_insure" inputmode="numeric" class="money" placeholder="35"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>대출 상환금</label>
            <div class="iu"><input type="text" name="exp_loan" inputmode="numeric" class="money" placeholder="70"><span class="unit">만원</span></div></div>
          <div class="field"><label>교통비</label>
            <div class="iu"><input type="text" name="exp_transport" inputmode="numeric" class="money" placeholder="30"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>통신비</label>
            <div class="iu"><input type="text" name="exp_telecom" inputmode="numeric" class="money" placeholder="15"><span class="unit">만원</span></div></div>
          <div class="field"><label>의료비</label>
            <div class="iu"><input type="text" name="exp_medical" inputmode="numeric" class="money" placeholder="10"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>의류/미용</label>
            <div class="iu"><input type="text" name="exp_clothes" inputmode="numeric" class="money" placeholder="15"><span class="unit">만원</span></div></div>
          <div class="field"><label>문화/여가</label>
            <div class="iu"><input type="text" name="exp_leisure" inputmode="numeric" class="money" placeholder="20"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>경조사/용돈</label>
            <div class="iu"><input type="text" name="exp_social" inputmode="numeric" class="money" placeholder="15"><span class="unit">만원</span></div></div>
          <div class="field"><label>기타 지출</label>
            <div class="iu"><input type="text" name="exp_etc" inputmode="numeric" class="money" placeholder="10"><span class="unit">만원</span></div></div>
        </div>
      </div>

      <div class="section">
        <div class="section-title"><span class="section-num">3</span>월 저축/투자 현황</div>
        <div class="row">
          <div class="field"><label>적금/예금 적립</label>
            <div class="iu"><input type="text" name="sav_deposit" inputmode="numeric" class="money" placeholder="50"><span class="unit">만원</span></div></div>
          <div class="field"><label>펀드/ETF 적립</label>
            <div class="iu"><input type="text" name="sav_fund" inputmode="numeric" class="money" placeholder="30"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>연금저축/IRP</label>
            <div class="iu"><input type="text" name="sav_pension" inputmode="numeric" class="money" placeholder="20"><span class="unit">만원</span></div></div>
          <div class="field"><label>청약/ISA/기타</label>
            <div class="iu"><input type="text" name="sav_etc" inputmode="numeric" class="money" placeholder="10"><span class="unit">만원</span></div></div>
        </div>
      </div>

      <div class="nav-btns">
        <button class="btn btn-prev" onclick="goStep(1)">← 이전</button>
        <button class="btn btn-next" onclick="goStep(3)">다음 →</button>
      </div>
    </div>

    <!-- ============ STEP 3: 자산·부채 ============ -->
    <div class="step-page" data-step="3">
      <div class="section">
        <div class="section-title"><span class="section-num">1</span>금융자산</div>
        <div class="section-desc">대략적인 금액이면 충분합니다</div>
        <div class="row">
          <div class="field"><label>예금 (입출금)</label>
            <div class="iu"><input type="text" name="a_savings" inputmode="numeric" class="money" placeholder="2000"><span class="unit">만원</span></div></div>
          <div class="field"><label>정기예금</label>
            <div class="iu"><input type="text" name="a_time_dep" inputmode="numeric" class="money" placeholder="5000"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>정기적금</label>
            <div class="iu"><input type="text" name="a_install" inputmode="numeric" class="money" placeholder="3000"><span class="unit">만원</span></div></div>
          <div class="field"><label>주식 (국내)</label>
            <div class="iu"><input type="text" name="a_stock_kr" inputmode="numeric" class="money" placeholder="4000"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>주식 (해외)</label>
            <div class="iu"><input type="text" name="a_stock_us" inputmode="numeric" class="money" placeholder="2000"><span class="unit">만원</span></div></div>
          <div class="field"><label>펀드/ETF</label>
            <div class="iu"><input type="text" name="a_fund" inputmode="numeric" class="money" placeholder="3000"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>채권/ELS</label>
            <div class="iu"><input type="text" name="a_bond" inputmode="numeric" class="money" placeholder="0"><span class="unit">만원</span></div></div>
          <div class="field"><label>보험 (해약환급금)</label>
            <div class="iu"><input type="text" name="a_insure_val" inputmode="numeric" class="money" placeholder="1500"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>퇴직금/퇴직연금</label>
            <div class="iu"><input type="text" name="a_retire_pen" inputmode="numeric" class="money" placeholder="8000"><span class="unit">만원</span></div></div>
          <div class="field"><label>IRP</label>
            <div class="iu"><input type="text" name="a_irp" inputmode="numeric" class="money" placeholder="2000"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>연금저축</label>
            <div class="iu"><input type="text" name="a_pen_sav" inputmode="numeric" class="money" placeholder="1500"><span class="unit">만원</span></div></div>
          <div class="field"><label>청약/ISA/기타</label>
            <div class="iu"><input type="text" name="a_isa" inputmode="numeric" class="money" placeholder="500"><span class="unit">만원</span></div></div>
        </div>
      </div>

      <div class="section">
        <div class="section-title"><span class="section-num">2</span>부동산 자산</div>
        <div class="row">
          <div class="field"><label>거주용 주택 (시가)</label>
            <div class="iu"><input type="text" name="a_home" inputmode="numeric" class="money" placeholder="70000"><span class="unit">만원</span></div></div>
          <div class="field"><label>투자용 부동산</label>
            <div class="iu"><input type="text" name="a_invest_re" inputmode="numeric" class="money" placeholder="0"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>토지</label>
            <div class="iu"><input type="text" name="a_land" inputmode="numeric" class="money" placeholder="0"><span class="unit">만원</span></div></div>
          <div class="field"><label>전세보증금 (임차)</label>
            <div class="iu"><input type="text" name="a_jeonse" inputmode="numeric" class="money" placeholder="0"><span class="unit">만원</span></div></div>
        </div>
      </div>

      <div class="section">
        <div class="section-title"><span class="section-num">3</span>기타 자산</div>
        <div class="row">
          <div class="field"><label>자동차 (시가)</label>
            <div class="iu"><input type="text" name="a_car" inputmode="numeric" class="money" placeholder="3000"><span class="unit">만원</span></div></div>
          <div class="field"><label>기타 자산</label>
            <div class="iu"><input type="text" name="a_other" inputmode="numeric" class="money" placeholder="500"><span class="unit">만원</span></div></div>
        </div>
      </div>

      <div class="section">
        <div class="section-title"><span class="section-num">4</span>부채 현황</div>
        <div class="sub-group"><span class="sg-label">주택담보대출</span>
          <div class="row3">
            <div class="field"><label>잔액</label><div class="iu"><input type="text" name="d_mortgage" inputmode="numeric" class="money"><span class="unit">만원</span></div></div>
            <div class="field"><label>금리(연%)</label><div class="iu"><input type="text" name="d_mortgage_r" inputmode="decimal"><span class="unit">%</span></div></div>
            <div class="field"><label>월상환</label><div class="iu"><input type="text" name="d_mortgage_m" inputmode="numeric" class="money"><span class="unit">만원</span></div></div>
          </div>
        </div>
        <div class="sub-group"><span class="sg-label">전세자금대출</span>
          <div class="row3">
            <div class="field"><label>잔액</label><div class="iu"><input type="text" name="d_jeonse" inputmode="numeric" class="money"><span class="unit">만원</span></div></div>
            <div class="field"><label>금리(연%)</label><div class="iu"><input type="text" name="d_jeonse_r" inputmode="decimal"><span class="unit">%</span></div></div>
            <div class="field"><label>월상환</label><div class="iu"><input type="text" name="d_jeonse_m" inputmode="numeric" class="money"><span class="unit">만원</span></div></div>
          </div>
        </div>
        <div class="sub-group"><span class="sg-label">신용대출</span>
          <div class="row3">
            <div class="field"><label>잔액</label><div class="iu"><input type="text" name="d_credit" inputmode="numeric" class="money"><span class="unit">만원</span></div></div>
            <div class="field"><label>금리(연%)</label><div class="iu"><input type="text" name="d_credit_r" inputmode="decimal"><span class="unit">%</span></div></div>
            <div class="field"><label>월상환</label><div class="iu"><input type="text" name="d_credit_m" inputmode="numeric" class="money"><span class="unit">만원</span></div></div>
          </div>
        </div>
        <div class="sub-group"><span class="sg-label">기타 대출</span>
          <div class="row3">
            <div class="field"><label>잔액</label><div class="iu"><input type="text" name="d_other" inputmode="numeric" class="money"><span class="unit">만원</span></div></div>
            <div class="field"><label>금리(연%)</label><div class="iu"><input type="text" name="d_other_r" inputmode="decimal"><span class="unit">%</span></div></div>
            <div class="field"><label>월상환</label><div class="iu"><input type="text" name="d_other_m" inputmode="numeric" class="money"><span class="unit">만원</span></div></div>
          </div>
        </div>
      </div>

      <div class="nav-btns">
        <button class="btn btn-prev" onclick="goStep(2)">← 이전</button>
        <button class="btn btn-next" onclick="goStep(4)">다음 →</button>
      </div>
    </div>

    <!-- ============ STEP 4: 보험 현황 ============ -->
    <div class="step-page" data-step="4">
      <div class="section">
        <div class="section-title"><span class="section-num">1</span>생명/건강보험</div>
        <div class="section-desc">가입하신 보험을 입력해주세요</div>
        <div class="ins-item">
          <div class="ins-label">종신보험 (사망)</div>
          <div class="row"><div class="field"><label>보험사/상품명</label><input type="text" name="ins_life_co" placeholder="삼성생명/종신보험"></div>
          <div class="field"><label>월 보험료</label><div class="iu"><input type="text" name="ins_life_fee" inputmode="numeric" class="money"><span class="unit">만원</span></div></div></div>
          <div class="field"><label>주요 보장</label><input type="text" name="ins_life_desc" placeholder="사망 1억원"></div>
        </div>
        <div class="ins-item">
          <div class="ins-label">암/CI 보험</div>
          <div class="row"><div class="field"><label>보험사/상품명</label><input type="text" name="ins_ci_co" placeholder="한화생명/암보험"></div>
          <div class="field"><label>월 보험료</label><div class="iu"><input type="text" name="ins_ci_fee" inputmode="numeric" class="money"><span class="unit">만원</span></div></div></div>
          <div class="field"><label>주요 보장</label><input type="text" name="ins_ci_desc" placeholder="암진단 3천만원"></div>
        </div>
        <div class="ins-item">
          <div class="ins-label">실손의료보험</div>
          <div class="row"><div class="field"><label>보험사/상품명</label><input type="text" name="ins_med_co" placeholder="삼성화재/실손보험"></div>
          <div class="field"><label>월 보험료</label><div class="iu"><input type="text" name="ins_med_fee" inputmode="numeric" class="money"><span class="unit">만원</span></div></div></div>
        </div>
        <div class="ins-item">
          <div class="ins-label">어린이/기타 보험</div>
          <div class="row"><div class="field"><label>보험사/상품명</label><input type="text" name="ins_child_co" placeholder="DB생명/어린이보험"></div>
          <div class="field"><label>월 보험료</label><div class="iu"><input type="text" name="ins_child_fee" inputmode="numeric" class="money"><span class="unit">만원</span></div></div></div>
          <div class="field"><label>주요 보장</label><input type="text" name="ins_child_desc" placeholder="입원/수술/실손"></div>
        </div>
      </div>

      <div class="section">
        <div class="section-title"><span class="section-num">2</span>연금/저축성 보험</div>
        <div class="ins-item">
          <div class="ins-label">연금보험</div>
          <div class="row"><div class="field"><label>보험사/상품명</label><input type="text" name="ins_pen_co" placeholder="신한라이프/연금보험"></div>
          <div class="field"><label>월 보험료</label><div class="iu"><input type="text" name="ins_pen_fee" inputmode="numeric" class="money"><span class="unit">만원</span></div></div></div>
          <div class="field"><label>예상 연금액</label><input type="text" name="ins_pen_desc" placeholder="월 50만원 예상"></div>
        </div>
        <div class="ins-item">
          <div class="ins-label">변액연금/저축보험</div>
          <div class="row"><div class="field"><label>보험사/상품명</label><input type="text" name="ins_var_co" placeholder="미래에셋/변액연금"></div>
          <div class="field"><label>월 보험료</label><div class="iu"><input type="text" name="ins_var_fee" inputmode="numeric" class="money"><span class="unit">만원</span></div></div></div>
        </div>
      </div>

      <div class="section">
        <div class="section-title"><span class="section-num">3</span>손해보험</div>
        <div class="ins-item">
          <div class="ins-label">자동차/화재/기타</div>
          <div class="row"><div class="field"><label>보험사/상품명</label><input type="text" name="ins_car_co" placeholder="삼성화재/자동차보험"></div>
          <div class="field"><label>월/연 보험료</label><div class="iu"><input type="text" name="ins_car_fee" inputmode="numeric" class="money"><span class="unit">만원</span></div></div></div>
        </div>
      </div>

      <div class="nav-btns">
        <button class="btn btn-prev" onclick="goStep(3)">← 이전</button>
        <button class="btn btn-next" onclick="goStep(5)">다음 →</button>
      </div>
    </div>

    <!-- ============ STEP 5: 은퇴설계 ============ -->
    <div class="step-page" data-step="5">
      <div class="section">
        <div class="section-title"><span class="section-num">1</span>은퇴 기본 정보</div>
        <div class="row">
          <div class="field"><label>예상 기대수명</label>
            <div class="iu"><input type="text" name="life_exp" inputmode="numeric" placeholder="85"><span class="unit">세</span></div></div>
          <div class="field"><label>배우자 기대수명</label>
            <div class="iu"><input type="text" name="sp_life_exp" inputmode="numeric" placeholder="90"><span class="unit">세</span></div></div>
        </div>
      </div>

      <div class="section">
        <div class="section-title"><span class="section-num">2</span>은퇴 후 예상 생활비 (월)</div>
        <div class="row">
          <div class="field"><label>기본 생활비</label>
            <div class="iu"><input type="text" name="ret_living" inputmode="numeric" class="money" placeholder="200"><span class="unit">만원</span></div></div>
          <div class="field"><label>의료비/건강관리</label>
            <div class="iu"><input type="text" name="ret_medical" inputmode="numeric" class="money" placeholder="30"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>여가/문화/여행</label>
            <div class="iu"><input type="text" name="ret_leisure" inputmode="numeric" class="money" placeholder="50"><span class="unit">만원</span></div></div>
          <div class="field"><label>경조사/용돈/기타</label>
            <div class="iu"><input type="text" name="ret_etc" inputmode="numeric" class="money" placeholder="40"><span class="unit">만원</span></div></div>
        </div>
      </div>

      <div class="section">
        <div class="section-title"><span class="section-num">3</span>은퇴 준비 현황 (예상 월수령액)</div>
        <div class="row">
          <div class="field"><label>국민연금 (본인)</label>
            <div class="iu"><input type="text" name="pen_national" inputmode="numeric" class="money" placeholder="80"><span class="unit">만원</span></div></div>
          <div class="field"><label>국민연금 (배우자)</label>
            <div class="iu"><input type="text" name="pen_national_sp" inputmode="numeric" class="money" placeholder="40"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>퇴직연금 (DB/DC/IRP)</label>
            <div class="iu"><input type="text" name="pen_retire" inputmode="numeric" class="money" placeholder="50"><span class="unit">만원</span></div></div>
          <div class="field"><label>개인연금</label>
            <div class="iu"><input type="text" name="pen_private" inputmode="numeric" class="money" placeholder="30"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>주택연금</label>
            <div class="iu"><input type="text" name="pen_home" inputmode="numeric" class="money" placeholder="0"><span class="unit">만원</span></div></div>
          <div class="field"><label>기타 은퇴 수입</label>
            <div class="iu"><input type="text" name="pen_etc" inputmode="numeric" class="money" placeholder="0"><span class="unit">만원</span></div></div>
        </div>
      </div>

      <div class="nav-btns">
        <button class="btn btn-prev" onclick="goStep(4)">← 이전</button>
        <button class="btn btn-next" onclick="goStep(6)">다음 →</button>
      </div>
    </div>

    <!-- ============ STEP 6: 목표자금 ============ -->
    <div class="step-page" data-step="6">
      <div class="section">
        <div class="section-title"><span class="section-num">1</span>주택 마련 자금</div>
        <div class="row">
          <div class="field"><label>목표 주택/지역</label>
            <input type="text" name="goal_home_type" placeholder="아파트 34평 / 서울 송파구"></div>
          <div class="field"><label>예상 매입가</label>
            <div class="iu"><input type="text" name="goal_home_price" inputmode="numeric" class="money" placeholder="120000"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>현재 준비 자금</label>
            <div class="iu"><input type="text" name="goal_home_ready" inputmode="numeric" class="money" placeholder="70000"><span class="unit">만원</span></div></div>
          <div class="field"><label>목표 시기</label>
            <input type="text" name="goal_home_when" placeholder="2030년"></div>
        </div>
      </div>

      <div class="section">
        <div class="section-title"><span class="section-num">2</span>자녀 교육 자금</div>
        <div class="sub-group"><span class="sg-label">자녀 1</span>
          <div class="row">
            <div class="field"><label>대학등록금</label><div class="iu"><input type="text" name="edu1_univ" inputmode="numeric" class="money"><span class="unit">만원</span></div></div>
            <div class="field"><label>유학/기타</label><div class="iu"><input type="text" name="edu1_abroad" inputmode="numeric" class="money"><span class="unit">만원</span></div></div>
          </div>
          <div class="field"><label>현재 준비액</label><div class="iu"><input type="text" name="edu1_ready" inputmode="numeric" class="money"><span class="unit">만원</span></div></div>
        </div>
        <div class="sub-group"><span class="sg-label">자녀 2</span>
          <div class="row">
            <div class="field"><label>대학등록금</label><div class="iu"><input type="text" name="edu2_univ" inputmode="numeric" class="money"><span class="unit">만원</span></div></div>
            <div class="field"><label>유학/기타</label><div class="iu"><input type="text" name="edu2_abroad" inputmode="numeric" class="money"><span class="unit">만원</span></div></div>
          </div>
          <div class="field"><label>현재 준비액</label><div class="iu"><input type="text" name="edu2_ready" inputmode="numeric" class="money"><span class="unit">만원</span></div></div>
        </div>
      </div>

      <div class="section">
        <div class="section-title"><span class="section-num">3</span>자녀 결혼 자금</div>
        <div class="row">
          <div class="field"><label>자녀1 지원 예상액</label>
            <div class="iu"><input type="text" name="wed1_amt" inputmode="numeric" class="money" placeholder="5000"><span class="unit">만원</span></div></div>
          <div class="field"><label>자녀2 지원 예상액</label>
            <div class="iu"><input type="text" name="wed2_amt" inputmode="numeric" class="money" placeholder="5000"><span class="unit">만원</span></div></div>
        </div>
      </div>

      <div class="section">
        <div class="section-title"><span class="section-num">4</span>기타 재무 목표</div>
        <div class="row">
          <div class="field"><label>비상예비자금</label>
            <div class="iu"><input type="text" name="goal_emergency" inputmode="numeric" class="money" placeholder="3000"><span class="unit">만원</span></div></div>
          <div class="field"><label>대출 조기상환</label>
            <div class="iu"><input type="text" name="goal_repay" inputmode="numeric" class="money" placeholder="0"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>여행/레저</label>
            <div class="iu"><input type="text" name="goal_travel" inputmode="numeric" class="money" placeholder="0"><span class="unit">만원</span></div></div>
          <div class="field"><label>기타 목표</label>
            <div class="iu"><input type="text" name="goal_other" inputmode="numeric" class="money" placeholder="0"><span class="unit">만원</span></div></div>
        </div>
      </div>

      <div class="nav-btns">
        <button class="btn btn-prev" onclick="goStep(5)">← 이전</button>
        <button class="btn btn-next" onclick="goStep(7)">다음 →</button>
      </div>
    </div>

    <!-- ============ STEP 7: 세금·절세 ============ -->
    <div class="step-page" data-step="7">
      <div class="section">
        <div class="section-title"><span class="section-num">1</span>연간 소득/세금</div>
        <div class="row">
          <div class="field"><label>연간 총급여 (본인)</label>
            <div class="iu"><input type="text" name="tax_salary" inputmode="numeric" class="money" placeholder="6600"><span class="unit">만원</span></div></div>
          <div class="field"><label>연간 사업소득 (배우자)</label>
            <div class="iu"><input type="text" name="tax_biz_sp" inputmode="numeric" class="money" placeholder="3000"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>기타소득 (임대/이자)</label>
            <div class="iu"><input type="text" name="tax_etc_inc" inputmode="numeric" class="money" placeholder="0"><span class="unit">만원</span></div></div>
          <div class="field"><label>연말정산 환급/추납</label>
            <div class="iu"><input type="text" name="tax_refund" inputmode="numeric" class="money" placeholder="50"><span class="unit">만원</span></div></div>
        </div>
      </div>

      <div class="section">
        <div class="section-title"><span class="section-num">2</span>소득공제 현황</div>
        <div class="row">
          <div class="field"><label>인적공제</label>
            <div class="iu"><input type="text" name="ded_person" inputmode="numeric" class="money" placeholder="150"><span class="unit">만원</span></div></div>
          <div class="field"><label>국민연금</label>
            <div class="iu"><input type="text" name="ded_np" inputmode="numeric" class="money" placeholder="50"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>카드/체크카드 공제</label>
            <div class="iu"><input type="text" name="ded_card" inputmode="numeric" class="money" placeholder="200"><span class="unit">만원</span></div></div>
          <div class="field"><label>주택청약 공제</label>
            <div class="iu"><input type="text" name="ded_housing" inputmode="numeric" class="money" placeholder="24"><span class="unit">만원</span></div></div>
        </div>
      </div>

      <div class="section">
        <div class="section-title"><span class="section-num">3</span>세액공제 현황</div>
        <div class="row">
          <div class="field"><label>연금계좌 (IRP/연금저축)</label>
            <div class="iu"><input type="text" name="cred_pension" inputmode="numeric" class="money" placeholder="70"><span class="unit">만원</span></div></div>
          <div class="field"><label>교육비</label>
            <div class="iu"><input type="text" name="cred_edu" inputmode="numeric" class="money" placeholder="30"><span class="unit">만원</span></div></div>
        </div>
        <div class="row">
          <div class="field"><label>의료비</label>
            <div class="iu"><input type="text" name="cred_med" inputmode="numeric" class="money" placeholder="15"><span class="unit">만원</span></div></div>
          <div class="field"><label>보장성보험료</label>
            <div class="iu"><input type="text" name="cred_insure" inputmode="numeric" class="money" placeholder="10"><span class="unit">만원</span></div></div>
        </div>
      </div>

      <div class="nav-btns">
        <button class="btn btn-prev" onclick="goStep(6)">← 이전</button>
        <button class="btn btn-next" onclick="goStep(8)">다음 →</button>
      </div>
    </div>

    <!-- ============ STEP 8: 투자성향·가치관 ============ -->
    <div class="step-page" data-step="8">
      <div class="section">
        <div class="section-title"><span class="section-num">1</span>투자 성향</div>
        <div class="row">
          <div class="field"><label>투자성향 (1~5)</label>
            <select name="inv_type">
              <option value="">선택</option>
              <option value="1">1 - 안정형</option>
              <option value="2">2 - 안정추구형</option>
              <option value="3">3 - 위험중립형</option>
              <option value="4">4 - 적극투자형</option>
              <option value="5">5 - 공격투자형</option>
            </select></div>
          <div class="field"><label>투자 경험</label>
            <input type="text" name="inv_exp" placeholder="주식+펀드+예금"></div>
        </div>
        <div class="row">
          <div class="field"><label>투자 경험 기간</label>
            <select name="inv_period">
              <option value="">선택</option>
              <option>1년 미만</option><option>1~3년</option>
              <option>3~5년</option><option>5~10년</option><option>10년 이상</option>
            </select></div>
          <div class="field"><label>손실 감내 수준</label>
            <select name="inv_loss">
              <option value="">선택</option>
              <option>-5%</option><option>-10%</option>
              <option>-20%</option><option>-30% 이상</option>
            </select></div>
        </div>
        <div class="row">
          <div class="field"><label>기대 수익률 (연)</label>
            <input type="text" name="inv_return" placeholder="7%"></div>
          <div class="field"><label>투자 가능 기간</label>
            <select name="inv_horizon">
              <option value="">선택</option>
              <option>1년 이내</option><option>3년</option>
              <option>5년</option><option>10년 이상</option>
            </select></div>
        </div>
      </div>

      <div class="section">
        <div class="section-title"><span class="section-num">2</span>재무 가치관</div>
        <div class="field"><label>안정성 vs 수익성</label>
          <select name="val_priority">
            <option value="">선택</option>
            <option>안정성 우선</option><option>수익성 우선</option><option>균형</option>
          </select></div>
        <div class="field"><label>가장 중요한 재무 목표</label>
          <input type="text" name="val_goal" placeholder="예: 은퇴 준비, 주택마련, 자녀교육"></div>
        <div class="field"><label>현재 가장 큰 재무 고민</label>
          <textarea name="val_worry" placeholder="자유롭게 작성해주세요"></textarea></div>
        <div class="field"><label>재무설계에서 기대하는 점</label>
          <textarea name="val_expect" placeholder="자유롭게 작성해주세요"></textarea></div>
      </div>

      <div class="section">
        <div class="section-title"><span class="section-num">3</span>상담 정보</div>
        <div class="row">
          <div class="field"><label>상담일시</label>
            <input type="text" name="consult_date" placeholder="2026.02.17"></div>
          <div class="field"><label>담당 FC</label>
            <input type="text" name="fc_name" id="fcNameField" readonly style="background:#F0EDE8; cursor:not-allowed;"></div>
        </div>
      </div>

      <div class="nav-btns">
        <button class="btn btn-prev" onclick="goStep(7)">← 이전</button>
      </div>
      <button class="btn btn-submit" id="submitBtn" onclick="submitForm()" style="margin-top:0.7rem;">제출하기</button>
    </div>
  </div>

  <div class="footer-note">
    <p>※ 정확한 금액이 아니어도 괜찮습니다. 대략적인 규모만 알려주셔도 됩니다.</p>
    <p style="margin-top:0.3rem;">※ 입력하신 정보는 재무설계 목적으로만 활용됩니다.</p>
  </div>
</div>

<!-- 완료 화면 -->
<div id="doneView" class="done-screen">
  <div class="done-icon">
    <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
  </div>
  <h2>제출 완료!</h2>
  <p>소중한 정보 감사합니다.<br>맞춤 재무설계를 준비하여<br>빠르게 연락드리겠습니다.</p>
</div>

<script>
// ============================================================
// Google Apps Script 웹앱 URL
// ============================================================
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwsgKgSGktuF9sK0GSQQU0MPW8bGGgFPAckPtDxzlPS6rzE_yoxQYBncyZ2LFDOir_pHw/exec';

// ============================================================
// FC 검색 로직
// ============================================================
const fcNameInput = document.getElementById('fcNameInput');
const fcSearchBtn = document.getElementById('fcSearchBtn');
const fcSearchResult = document.getElementById('fcSearchResult');
const fcConfirmed = document.getElementById('fcConfirmed');
const fcNextBtn = document.getElementById('fcNextBtn');

let selectedFC = null;

fcSearchBtn.addEventListener('click', searchFC);
fcNameInput.addEventListener('keydown', function(e) {
  if (e.key === 'Enter') { e.preventDefault(); searchFC(); }
});

async function searchFC() {
  const name = fcNameInput.value.trim();
  if (!name) { alert('이름을 입력해주세요.'); fcNameInput.focus(); return; }

  fcSearchBtn.disabled = true;
  fcSearchBtn.textContent = '검색 중...';
  fcSearchResult.style.display = 'none';
  fcConfirmed.style.display = 'none';
  selectedFC = null;
  fcNextBtn.disabled = true;
  fcNextBtn.style.opacity = '0.4';

  try {
    const url = SCRIPT_URL + '?action=searchFC&name=' + encodeURIComponent(name);
    const res = await fetch(url);
    const json = await res.json();

    if (json.status === 'ok' && json.results && json.results.length > 0) {
      if (json.results.length === 1) {
        confirmFC(json.results[0]);
      } else {
        let html = '<p style="font-size:0.85rem; color:var(--text); margin-bottom:0.5rem;">검색 결과 ' + json.results.length + '명:</p>';
        json.results.forEach(fc => {
          html += '<button type="button" class="fc-pick-btn" onclick=\'confirmFC(' + JSON.stringify(fc).replace(/'/g,"&#39;") + ')\''
            + ' style="display:block; width:100%; text-align:left; padding:0.7rem 1rem; margin-bottom:0.4rem; background:#F7F5F2; border:1px solid #E8E4DF; border-radius:0.5rem; cursor:pointer; font-size:0.85rem;">'
            + fc.name + ' <span style="color:#8C8680;">(' + fc.branch + ')</span></button>';
        });
        fcSearchResult.innerHTML = html;
        fcSearchResult.style.display = 'block';
      }
    } else {
      fcSearchResult.innerHTML = '<p style="color:#C75C5C; font-size:0.85rem;">해당 이름의 FC를 찾을 수 없습니다.</p>';
      fcSearchResult.style.display = 'block';
    }
  } catch (err) {
    fcSearchResult.innerHTML = '<p style="color:#C75C5C; font-size:0.85rem;">검색 중 오류가 발생했습니다. 다시 시도해주세요.</p>';
    fcSearchResult.style.display = 'block';
  }
  fcSearchBtn.disabled = false;
  fcSearchBtn.textContent = '검색';
}

function confirmFC(fc) {
  selectedFC = fc;
  fcSearchResult.style.display = 'none';
  fcConfirmed.style.display = 'block';
  document.getElementById('fcConfirmedText').textContent = '✓ ' + fc.name + ' (' + fc.branch + ')';
  document.getElementById('fcId').value = fc.id;
  document.getElementById('fcNameVal').value = fc.name;
  fcNextBtn.disabled = false;
  fcNextBtn.style.opacity = '1';
}

fcNextBtn.addEventListener('click', function() {
  if (!selectedFC) return;
  document.getElementById('fcSearchView').style.display = 'none';
  document.getElementById('formView').style.display = 'block';
  // Step 8의 담당 FC 필드 자동 채우기
  const fcField = document.getElementById('fcNameField');
  if (fcField) fcField.value = selectedFC.name;
});

// ============================================================
// 스텝 네비게이션
// ============================================================
const STEP_TITLES = [
  '', '기본 인적사항', '수입·지출', '자산·부채', '보험 현황',
  '은퇴설계', '목표자금', '세금·절세', '투자성향·가치관'
];
let currentStep = 1;

function goStep(n) {
  // 필수 체크 (Step 1)
  if (n > 1 && currentStep === 1) {
    const name = document.querySelector('[name="name"]').value.trim();
    if (!name) {
      showError('성명을 입력해주세요.');
      document.querySelector('[name="name"]').focus();
      return;
    }
  }
  hideError();
  document.querySelectorAll('.step-page').forEach(p => p.classList.remove('active'));
  document.querySelector(`.step-page[data-step="${n}"]`).classList.add('active');

  // 인디케이터 업데이트
  document.querySelectorAll('.step-dot').forEach(dot => {
    const s = parseInt(dot.dataset.step);
    dot.classList.remove('active', 'done');
    if (s < n) dot.classList.add('done');
    else if (s === n) dot.classList.add('active');
  });
  document.querySelectorAll('.step-line').forEach((line, i) => {
    line.classList.toggle('done', i < n - 1);
  });
  document.getElementById('stepTitle').textContent = `Step ${n} — ${STEP_TITLES[n]}`;

  currentStep = n;
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// ============================================================
// 에러
// ============================================================
function showError(msg) {
  const el = document.getElementById('errorMsg');
  el.textContent = msg;
  el.style.display = 'block';
}
function hideError() {
  document.getElementById('errorMsg').style.display = 'none';
}

// ============================================================
// 자동 포맷
// ============================================================
// 금액 콤마
document.querySelectorAll('.money').forEach(input => {
  input.addEventListener('input', function() {
    let v = this.value.replace(/[^0-9]/g, '');
    if (v) this.value = Number(v).toLocaleString();
  });
});
// 전화번호
document.querySelectorAll('.auto-phone').forEach(input => {
  input.addEventListener('input', function() {
    let v = this.value.replace(/[^0-9]/g, '');
    if (v.length > 3 && v.length <= 7) v = v.slice(0,3)+'-'+v.slice(3);
    else if (v.length > 7) v = v.slice(0,3)+'-'+v.slice(3,7)+'-'+v.slice(7,11);
    this.value = v;
  });
});
// 생년월일
document.querySelectorAll('.auto-date').forEach(input => {
  input.addEventListener('input', function() {
    let v = this.value.replace(/[^0-9]/g, '');
    if (v.length > 4 && v.length <= 6) v = v.slice(0,4)+'.'+v.slice(4);
    else if (v.length > 6) v = v.slice(0,4)+'.'+v.slice(4,6)+'.'+v.slice(6,8);
    this.value = v;
  });
});

// ============================================================
// 제출
// ============================================================
async function submitForm() {
  const btn = document.getElementById('submitBtn');
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span>제출 중...';
  hideError();

  // 전체 폼 데이터 수집
  const data = { form_type: 'full' };
  document.querySelectorAll('input, select, textarea').forEach(el => {
    if (el.name) data[el.name] = el.value.replace(/,/g, '').trim();
  });
  data.timestamp = new Date().toLocaleString('ko-KR');
  data.fc_id = document.getElementById('fcId').value;

  try {
    if (!SCRIPT_URL) {
      console.log('데이터:', data);
      alert('테스트: SCRIPT_URL 미설정');
      btn.disabled = false; btn.innerHTML = '제출하기';
      return;
    }

    await fetch(SCRIPT_URL, {
      method: 'POST', mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    document.getElementById('formView').style.display = 'none';
    document.getElementById('doneView').style.display = 'block';
    window.scrollTo(0, 0);
  } catch (err) {
    showError('전송 오류가 발생했습니다. 잠시 후 다시 시도해주세요.');
    btn.disabled = false; btn.innerHTML = '제출하기';
  }
}
</script>
</body>
</html>
